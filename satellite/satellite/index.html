
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Satellite - IBM Cloud Satellite Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deploy-to-a-remote-location-with-ibm-cloud-satellite" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="IBM Cloud Satellite Tutorials" class="md-header__button md-logo" aria-label="IBM Cloud Satellite Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IBM Cloud Satellite Tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Satellite
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IBM Cloud Satellite Tutorials" class="md-nav__button md-logo" aria-label="IBM Cloud Satellite Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IBM Cloud Satellite Tutorials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Satellite/satellite.md" class="md-nav__link">
        Deploy Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CP4D/satellite-cp4d.md" class="md-nav__link">
        CP4D on Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../LB/satellite-lb.md" class="md-nav__link">
        Expose an Application with a Load Balancer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VPC/vpc.md" class="md-nav__link">
        Create VPC Infrastructure for Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/vpn.md" class="md-nav__link">
        Connect a private location with VPN
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="deploy-to-a-remote-location-with-ibm-cloud-satellite">Deploy to a Remote Location with IBM Cloud Satellite</h1>
<p><strong>Kevin Collins ( kevincollins@us.ibm.com )</strong><br />
<strong>Kunal Malhotra ( kunal.malhotra3@ibm.com )</strong></p>
<h1 id="1-introduction">1 - Introduction</h1>
<p>In the next few sections, we will be setting up and provisioning our
zero to cloud native app to run on a remote location by leveraging IBM
Cloud Satellite. IBM Cloud Satellite allows you to deploy IBM Cloud
services anywhere you need them and is delivered as service through a
single pane of glass.</p>
<p>In this series, we will be deploying IBM Cloud Satellite in a private
only Virtual Private Cloud on IBM Cloud with no connectivity to the
Internet. This will simulate a realistic use case in deploying IBM Cloud
to a private location. While this tutorial series will walk through step
by step in setting up a private virtual private cloud on IBM Cloud</p>
<h1 id="2-provision-ibm-cloud-satellite">2 -- Provision IBM Cloud Satellite</h1>
<p>The first step to get started with IBM Cloud Satellite is to provision a
Satellite location. A location are the central part of your satellite
deployment and is where all of your IBM Cloud Services will run.</p>
<h2 id="21-create-a-satellite-location">2.1 Create a Satellite Location</h2>
<p>To get started in provisioning your satellite location, from the IBM
Cloud menu navigate to and select Satellite.</p>
<p><img alt="Graphical user interface, application, website Description
automatically
generated" src="../media/image1.png" /></p>
<p>Next, get started by clicking Create a Satellite location.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image2.png" /></p>
<p>Give your satellite location a meaningful name such as
satellite-zero-to-cloud-native, select the IBM Cloud location that will
manage your satellite location, I will select Washington DC, and click
Create Location.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image3.png" /></p>
<p>This will bring you to a screen that will show you satellite location is
being created. This takes a couple of minutes.</p>
<p>After our location is created, we will need to add hosts to the
location. These hosts can be anywhere, from onPrem, to a cloud provider
such as AWS, Azure, GCP, or even IBM Cloud. The hosts can be physical or
virtual, the choice is yours. There are minimum hardware requirements
for your satellite hosts that you can view here:</p>
<p><a href="https://cloud.ibm.com/docs/satellite?topic=satellite-host-reqs">https://cloud.ibm.com/docs/satellite?topic=satellite-host-reqs</a></p>
<h2 id="22-download-attach-hosts-script">2.2 Download Attach Hosts Script</h2>
<p>Our satellite location will have two types of hosts which will be VPC
instances. Hosts for the control plan and hosts for our IBM Cloud
Managed OpenShift worker nodes. As you will see after your
infrastructure hosts are provisioned we will need to run a script to
attach those instances to our satellite location. A best practice is to
include those scripts in the instance template we use to build the
instances for our satellite location.</p>
<p>To get the script to attach hosts to the satellite location, click on
<strong>Hosts</strong> from the satellite page.</p>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../media/image4.png" /></p>
<p>Then select <strong>Attach host</strong></p>
<p><img alt="A picture containing table Description automatically generated" src="../media/image5.png" /></p>
<hr />
<p>On the next screen, add a tag for the control plane instances. Entering
meaningful tags is another best practice that will allow us to quickly
find and identify specific hosts.</p>
<p>Label: <strong>host:02cn-control-plane</strong></p>
<p>Filename: <strong>attachHost-satellite-02cn-control-plane.sh</strong></p>
<p>Note: A best practice is to have different labels for control plane and
worker node instances, so it is easy to tell them apart.</p>
<p><img alt="Graphical user interface, text, application, email Description
automatically
generated" src="../media/image6.png" /></p>
<p>After entering these settings, click <strong>Download Script</strong>.</p>
<p>Repeat the same process of clicking Attach host and downloading a script
for the worker nodes with these values:</p>
<p>Label: <strong>host:02cn-worker</strong></p>
<p>Filename: <strong>attachHost-satellite-02cn-worker.sh</strong></p>
<h2 id="3-provision-infrastructure">3 - Provision Infrastructure</h2>
<p>To use a Satellite location, you need to provide infrastructure for
Satellite to run on it. You can deploy Satellite wherever you want, it
could be on-premises, on any cloud provider, or even at the edge.</p>
<p>In section 14A <a href="https://github.com/kmcolli/satellite/blob/master/docs/vpc/vpc.md">IBM Cloud VPC Infrastructure for Satellite</a>, there are instructions to create infrastructure
leveraging IBM Cloud Virtual Private Cloud. If you prefer to use a
different cloud provider or even an on-premises infrastructure, then
that is more than fine. The remaining steps of this tutorial series will
work regardless of where you the infrastructure is deployed. That is the
beauty of IBM Cloud Satellite, it runs wherever you are.</p>
<p>Click the link below to setup IBM Cloud VPC Infrastructure for your Satellite location:</p>
<p><a href="https://github.com/kmcolli/satellite/blob/master/docs/vpc/vpc.md">IBM Cloud VPC Infrastructure for Satellite</a> </p>
<h2 id="4-setup-your-satellite-location">4 Setup your Satellite Location</h2>
<p>Once you have all of your infrastructure provisioned and ready, the
first thing you will want to do is deploy an OpenShift Cluster.</p>
<h2 id="41-assign-control-plane-hosts">4.1 Assign Control Plane Hosts</h2>
<p>Before we can deploy an OpenShift cluster, we need to setup up our
control plan by assigning the hosts we created for the control plane to
the control plane.</p>
<p>While in the IBM Cloud Console, from the satellite menu click on
Locations and then your satellite-zero-to-cloud-native location.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image7.png" /></p>
<p>On next screen, click on hosts.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image8.png" /></p>
<p>This will show you a list of all the hosts that are assigned to your
location. When you provisioned the VSIs, the attachHosts script that we
ran is what has registered your hosts with your satellite location.</p>
<p>On the next screen, you will see that all of your hosts are Ready and
Unassigned. Next to each 'control plane' host, click Assign host by
clicking the three dots.</p>
<p><img alt="Graphical user interface Description automatically
generated" src="../media/image9.png" /></p>
<p>On the next screen you assign the host to a cluster. Make the following
assignments:</p>
<p>satellite-control-plane-dal1 = us-east-1</p>
<p>satellite-control-plane-dal2 = us-east-2</p>
<p>satellite-control-plane-dal3 = us-east-3</p>
<p><img alt="Graphical user interface, text, application, email Description
automatically
generated" src="../media/image10.png" /></p>
<p>Assigning hosts takes a couple of minutes. When the assignment is
complete, you will see the status of the hosts change as follows:</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image11.png" /></p>
<h2 id="42-create-ibm-cloud-managed-openshift-cluster">4.2 Create IBM Cloud Managed OpenShift Cluster</h2>
<p>Before trying to create a cluster, you need to make sure your Satellite
location and infrastructure control plane is ready to deploy. Navigating
to your satellite location, ensure that the control plan hosts are in
Healthy State and the overall Satellite location is normal.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image11.png" /></p>
<p>To provision a RedHat OpenShift on IBM Cloud cluster, go to the IBM
Cloud catalog, search for OpenShift, and click on the tile.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image12.png" /></p>
<p>On the next screen, enter the following information about your Satellite
location to create a new cluster.</p>
<p>Version: <strong>Select the most recent version of OpenShift</strong>.</p>
<p>Infrastructure: <strong>Satellite</strong></p>
<p>Location -- <strong>Resource Group -- zero-to-cloud-native</strong></p>
<p>Location -- <strong>Satellite -- satellite-zero-to-cloud-native</strong></p>
<p>Cluster name: <strong>satellite-02cn</strong></p>
<p>After entering these settings, click <strong>create Cluster</strong>. This will go
off and start building the master nodes of your cluster and takes about
20 minutes.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image13.png" /></p>
<p>While this is completing, navigate to the Overview page of your cluster
and you will notice a couple of things.</p>
<p>The Master Status will show Deploy in progress, this will change to
Ready when the master nodes are completely deployed.</p>
<p>The Worker Nodes section will indicate that you don't have any nodes
yet.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image14.png" /></p>
<p>The next thing we will need to do is assign worker nodes to our cluster.</p>
<h2 id="43-assign-worker-nodes">4.3 Assign Worker Nodes</h2>
<p>To assign worker nodes to our satellite cluster, navigate back to your
satellite location and the hosts tab.</p>
<p>Next to each worker node, click on Assign host.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image15.png" /></p>
<p>And select the cluster you created in the previous step and click Assign
host.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image16.png" /></p>
<p>Repeat the same steps for all the worker nodes.</p>
<p>This will register hosts that your IBM Cloud Managed OpenShift cluster
will use as worker nodes. In about 10 minutes, you will find all your
worker nodes in a Normal status and you can start using your cluster.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image17.png" /></p>
<h2 id="44-create-an-openvpn-connection">4.4 Create an OpenVPN Connection</h2>
<p>Because our cluster is on a private VPC with no Internet connectivity,
we will need to create a VPN connection into our VPC. The instructions
are rather long, so please refer to part 14B <a href="https://github.com/kmcolli/satellite/blob/master/docs/vpn/vpn.md">VPN Guide</a>  for detailed instructions
on doing so.</p>
<p>You can find instructions here on how to create a VPN Connection to IBM Cloud:
<a href="https://github.com/kmcolli/satellite/blob/master/docs/vpn/vpn.md">VPN Guide</a> </p>
<h2 id="45-enable-the-openshift-console">4.5 Enable the OpenShift Console</h2>
<p>There is one last step we need to perform so we can use the OpenShift
console. This does require that you have successfully configured an
OpenVPN connection into your VPC.</p>
<p>To test your VPN connection has been successful, run the following
commands:</p>
<p>Log into IBM Cloud:</p>
<pre><code>ibmcloud login --apikey=\&lt;your cloud apikey\&gt;

Target your cluster:

ibmcloud ks cluster config -c satellite-02cn \--admin
</code></pre>
<p>*If you used a different cluster name, you will need to update
satellite-02cn with that cluster name</p>
<p>View your worker nodes:</p>
<pre><code>oc get nodes
</code></pre>
<p>If you see a list of all your worker nodes like the following then your
VPN connection is successful! ... if not, revisit the OpenVPN section.</p>
<p><img alt="A picture containing text Description automatically
generated" src="../media/image18.png" /></p>
<p>Now that we have verified our VPN connection was successful, we need to
execute a couple more commands so that our OpenShift console works.
These commands require calicoctl. If you don't have the calicoctl CLI
installed on your system you can do so with the following command:</p>
<blockquote>
<p>brew install calicoctl</p>
</blockquote>
<p>Before we can launch the OpenShift console, we need to enable VXLAN
encapsulation instead of the default IP in IP encapsulation.</p>
<p>To do this, save the following yaml file.</p>
<p>pool.yaml</p>
<pre><code>apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: default-ipv4-ippool
spec:
  blockSize: 26
  cidr: 172.30.0.0/16
  ipipMode: Never
  natOutgoing: true
  nodeSelector: all()
  vxlanMode: Always
</code></pre>
<p>and run the following:</p>
<pre><code>ibmcloud ks cluster config \--admin -c satellite-02cn

export DATASTORE_TYPE=kubernetes

calicoctl apply -f /path/to/pool.yaml
</code></pre>
<p>Now for the moment of truth! Navigate to your satellite-02cn cluster in
the IBM Cloud console and click on <strong>OpenShift web console</strong>.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image19.png" /></p>
<p>This will launch your OpenShift Console.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image20.png" /></p>
<p>Congratulations, you have now setup and configured a private satellite
location with an OpenShift Cluster managed by IBM Cloud!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56a63758.min.js"></script>
      
    
  </body>
</html>