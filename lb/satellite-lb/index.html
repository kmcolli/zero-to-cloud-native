
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Satellite lb - IBM Cloud Satellite Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exposing-an-openshift-application-to-the-internet-from-a-private-satellite-cluster-using-a-load-balancer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="IBM Cloud Satellite Tutorials" class="md-header__button md-logo" aria-label="IBM Cloud Satellite Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IBM Cloud Satellite Tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Satellite lb
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IBM Cloud Satellite Tutorials" class="md-nav__button md-logo" aria-label="IBM Cloud Satellite Tutorials" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IBM Cloud Satellite Tutorials
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Satellite/satellite.md" class="md-nav__link">
        Deploy Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../CP4D/satellite-cp4d.md" class="md-nav__link">
        CP4D on Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../LB/satellite-lb.md" class="md-nav__link">
        Expose an Application with a Load Balancer
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VPC/vpc.md" class="md-nav__link">
        Create VPC Infrastructure for Satellite
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../VPN/vpn.md" class="md-nav__link">
        Connect a private location with VPN
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="exposing-an-openshift-application-to-the-internet-from-a-private-satellite-cluster-using-a-load-balancer">Exposing an OpenShift application to the Internet from a ‘private’ Satellite Cluster using a Load Balancer</h1>
<p><strong>Kevin Collins ( kevincollins@us.ibm.com )</strong><br />
<strong>Kunal Malhotra ( kunal.malhotra3@ibm.com )</strong></p>
<p>Let's say you have deployed a RedHat OpenShift Cluster via IBM Cloud
Satellite in a private isolated network in your datacenter and now you
have deployed certain applications on this OpenShift Cluster which are
required to be exposed to the public Internet. According to the current
design the only way it is possible to expose the application to the
public Internet is either you expose your whole satellite location to
the Internet or use networking infrastructure such as (load balancer,
http/https/TLS proxy etc.).</p>
<p>Exposing the whole satellite location brings up a huge security concern
i.e. anybody from the outside world can access you satellite control
plane in the datacenter or the OpenShift worker nodes themselves and
this is not ideal for any enterprise. Hence using networking
infrastructure make much more sense for both security and operational
points to expose applications to the Internet. This involves having a
networking device outside of the cluster and configuring the load
balancer to access a NodePort service on your OpenShift Cluster. Not
only will you find this method more secure, it also scales better. In
tutorial we will show you how to NAT the traffic coming from the
Internet to your internal private network via a load balancer so that
your application is accessible via the internet.</p>
<p>Note: This step-by-step tutorial have been performed on IBM Cloud, but
steps should be similar on other public cloud providers and on-prem.</p>
<h1 id="create-a-load-balancer-service-with-your-cloud-provider">Create a load balancer service with your cloud provider.</h1>
<p><strong>IBM Cloud Example:</strong></p>
<p>From the IBM Cloud menu, navigate to <strong>VPC Infrastructure</strong> and under
<strong>Network</strong>, select <strong>Load Balancers</strong>, and click <strong>Create</strong>.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image1.png" /></p>
<h2 id="configure-the-load-balancer">Configure the Load Balancer</h2>
<p>Give the load balancer a <strong>name</strong>, select <strong>Application Load Balancer</strong>,
select the <strong>Region</strong> where your satellite hosts are, select your
<strong>virtual private cloud</strong> your hosts are in, and finally select <strong>all
subnets</strong> for your VPC.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image2.png" /></p>
<h2 id="create-a-backend-pool">Create a backend pool</h2>
<p>In OpenShift, get the nodeport of the service you want to expose to the
Internet.</p>
<p><strong>Example to Test:</strong></p>
<p>Create a new openshift application</p>
<pre><code>oc new-app openshift/hello-openshift
</code></pre>
<p>This creates a pod and a cluster ip service.</p>
<p>Edit the service, search for ClusterIP and change it to NodePort. Save
the service.</p>
<pre><code>oc edit svc hello-openshift
</code></pre>
<p>Note the port of the service.</p>
<p><img alt="" src="../media/image3.png" /></p>
<p>In this case, we want to create a load balancer for the service running
on port 8080 which maps to port 30268 in the cluster.</p>
<h2 id="create-a-backend-pool_1">Create a backend pool</h2>
<p>Back on the create load balancer page, click on <strong>New Pool</strong> in the
backend pool section.</p>
<p><img alt="Graphical user interface Description automatically generated with low
confidence" src="../media/image4.png" /></p>
<p>Following the above example, we will use the name hello-openshift and
for Health Port, but the port number we got in the previous step ... in
this case 30268.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image5.png" /></p>
<p><strong>Attach Virtual Hosts to the Backend Pool.</strong></p>
<p>Under the backend pool section, click on <strong>attach</strong>.</p>
<p><img alt="A picture containing graphical user interface Description
automatically generated" src="../media/image6.png" /></p>
<p>On the next screen select the first subnet, and then select the first
worker node instance, and use the same port number ( 30268 in our case
). Click add and <strong>repeat the same steps for every subnet and every
worker node</strong> in the cluster.</p>
<p><img alt="Graphical user interface, text, application Description automatically
generated" src="../media/image7.png" /></p>
<p>*Important note -- when you add or remove worker nodes in your cluster,
will need to go back to this backend pool and either add the new worker
node or remove it from this backend pool.</p>
<p>After entering all the worker nodes, they should all appear in attached
instances.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image8.png" /></p>
<h2 id="create-front-end-listener">Create Front-end Listener</h2>
<p>Under front-end listeners, click on <strong>New listener</strong>.</p>
<p><img alt="Background pattern Description automatically generated with medium
confidence" src="../media/image9.png" /></p>
<p>On the next screen, enter the node port from your service ( in the
example above 30280 ), select your backend pool, and then enter 15000 as
the maximum connections, and then click save.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image10.png" /></p>
<h2 id="create-the-load-balancer">Create the load balancer</h2>
<p>On the panel on the right hand side of the screen, click on Create Load
Balancer.</p>
<p><img alt="Graphical user interface, application, Teams Description automatically
generated" src="../media/image11.png" /></p>
<h2 id="get-the-load-balancer-host-name">Get the load balancer host name</h2>
<p>The load balancer will take a few minutes to create. After it is
created, you can view the hostname from the overview page.</p>
<p><img alt="Graphical user interface, application Description automatically
generated" src="../media/image12.png" /></p>
<h2 id="test-the-load-balancer">Test the load balancer</h2>
<p>If you are following the example in this document, you can curl the
hostname and it should tell you "Hello Openshift"</p>
<p><img alt="" src="../media/image13.png" /></p>
<p>Note, it can take a couple of minutes for DNS to be updated. If you want
to test right away run</p>
<pre><code>host \&lt;hostname\&gt;
</code></pre>
<p>This will return 2 IPs, like below that you can then curl instead of the
hostname if you want to test right away.</p>
<p><img alt="" src="../media/image14.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56a63758.min.js"></script>
      
    
  </body>
</html>